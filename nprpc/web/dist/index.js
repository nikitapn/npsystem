!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("nprpc_runtime",[],e):"object"==typeof exports?exports.nprpc_runtime=e():t.nprpc_runtime=e()}(self,(()=>(()=>{"use strict";var t={653:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e},a=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.FlatBuffer=e.Flat=void 0;const o=n(s(934));e.Flat=o;const _=s(95);Object.defineProperty(e,"FlatBuffer",{enumerable:!0,get:function(){return _.FlatBuffer}}),a(s(593),e),a(s(519),e)},519:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Exception=void 0;class s extends Error{constructor(t){super(t)}}e.Exception=s},934:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Optional_Direct2=e.Optional_Direct1_f64=e.Optional_Direct1_f32=e.Optional_Direct1_i64=e.Optional_Direct1_u64=e.Optional_Direct1_i32=e.Optional_Direct1_u32=e.Optional_Direct1_i16=e.Optional_Direct1_u16=e.Optional_Direct1_i8=e.Optional_Direct1_u8=e.String_Direct1=e.Array_Direct2=e.Array_Direct1_f64=e.Array_Direct1_f32=e.Array_Direct1_i64=e.Array_Direct1_u64=e.Array_Direct1_i32=e.Array_Direct1_u32=e.Array_Direct1_i16=e.Array_Direct1_u16=e.Array_Direct1_i8=e.Array_Direct1_u8=e.Vector_Direct2=e.Vector_Direct1_f64=e.Vector_Direct1_f32=e.Vector_Direct1_i64=e.Vector_Direct1_u64=e.Vector_Direct1_i32=e.Vector_Direct1_u32=e.Vector_Direct1_i16=e.Vector_Direct1_u16=e.Vector_Direct1_i8=e.Vector_Direct1_u8=e._alloc1=e._alloc=e.Flat=void 0;class s{buffer;offset;constructor(t,e){this.buffer=t,this.offset=e}}function r(t,e,s,r,i){if(0==s)return t.dv.setUint32(e,0,!0),t.dv.setUint32(e+4,0,!0),0;let n=t.offset%i,a=n?t.offset+(i-n):t.offset;{let e=s*r+(a-t.offset);t.prepare(e),t.commit(e)}return t.dv.setUint32(e,a-e,!0),t.dv.setUint32(e+4,s,!0),a}function i(t,e,s,r){let i=t.offset%r,n=i?t.offset+(r-i):t.offset;{let e=s+(n-t.offset);t.prepare(e),t.commit(e)}return t.dv.setUint32(e,n-e,!0),n}e.Flat=s,e._alloc=r,e._alloc1=i;class n extends s{get elements_offset(){return this.offset+this.buffer.dv.getUint32(this.offset,!0)}get elements_size(){return this.buffer.dv.getUint32(this.offset+4,!0)}}class a extends s{buffer;offset;size;get elements_offset(){return this.offset}get elements_size(){return this.size}constructor(t,e,s){super(t,e),this.buffer=t,this.offset=e,this.size=s}}function o(t){return class extends t{[Symbol.iterator](){let t=this;const e=t.elements_size;let s=0;return{next:()=>s<e?{value:t.at(s++),done:!1}:{value:e,done:!0}}}}}function _(t){return class extends t{[Symbol.iterator](){let t=this;const e=t.elements_size;let s=0;return{next:()=>s<e?{value:t.at(s++),done:!1}:{value:e,done:!0}}}}}function f(t){return class extends t{at(t){return this.buffer.dv.getUint8(this.elements_offset+t)}set(t,e){this.buffer.dv.setUint8(this.elements_offset+t,e)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setUint8(e,s),e+=1}get array_buffer(){let t=this.elements_offset;return this.buffer.array_buffer.slice(t,t+this.elements_size)}get data_view(){return new DataView(this.buffer.array_buffer,this.elements_offset)}}}function c(t){return class extends t{at(t){return this.buffer.dv.getInt8(this.elements_offset+t)}set(t,e){this.buffer.dv.setInt8(this.elements_offset+t,e)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setInt8(e,s),e+=1}}}function u(t){return class extends t{at(t){return this.buffer.dv.getUint16(this.elements_offset+2*t,!0)}set(t,e){this.buffer.dv.setUint16(this.elements_offset+2*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setUint16(e,s,!0),e+=2}}}function l(t){return class extends t{at(t){return this.buffer.dv.getInt16(this.elements_offset+2*t,!0)}set(t,e){this.buffer.dv.setInt16(this.elements_offset+2*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setInt16(e,s,!0),e+=2}}}function d(t){return class extends t{at(t){return this.buffer.dv.getUint32(this.elements_offset+4*t,!0)}set(t,e){this.buffer.dv.setUint32(this.elements_offset+4*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setUint32(e,s,!0),e+=4}}}function h(t){return class extends t{at(t){return this.buffer.dv.getInt32(this.elements_offset+4*t,!0)}set(t,e){this.buffer.dv.setInt32(this.elements_offset+4*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setInt32(e,s,!0),e+=4}}}function p(t){return class extends t{at(t){return this.buffer.dv.getBigUint64(this.elements_offset+8*t,!0)}set(t,e){this.buffer.dv.setBigUint64(this.elements_offset+8*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setBigUint64(e,s,!0),e+=8}}}function b(t){return class extends t{at(t){return this.buffer.dv.getBigInt64(this.elements_offset+8*t,!0)}set(t,e){this.buffer.dv.setBigInt64(this.elements_offset+8*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setBigInt64(e,s,!0),e+=8}}}function v(t){return class extends t{at(t){return this.buffer.dv.getFloat32(this.elements_offset+4*t,!0)}set(t,e){this.buffer.dv.setFloat32(this.elements_offset+4*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setFloat32(e,s,!0),e+=4}}}function m(t){return class extends t{at(t){return this.buffer.dv.getFloat64(this.elements_offset+8*t,!0)}set(t,e){this.buffer.dv.setFloat64(this.elements_offset+8*t,e,!0)}copy_from_ts_array(t){let e=this.elements_offset;for(let s of t)this.buffer.dv.setFloat64(e,s,!0),e+=8}}}e.Vector_Direct1_u8=o(f(n)),e.Vector_Direct1_i8=o(c(n)),e.Vector_Direct1_u16=o(u(n)),e.Vector_Direct1_i16=o(l(n)),e.Vector_Direct1_u32=o(d(n)),e.Vector_Direct1_i32=o(h(n)),e.Vector_Direct1_u64=_(p(n)),e.Vector_Direct1_i64=_(b(n)),e.Vector_Direct1_f32=o(v(n)),e.Vector_Direct1_f64=o(m(n));class g extends n{element_size;flat_struct_constructor;*[Symbol.iterator](){let t=this.elements_size;for(let e=0;e<t;++e)yield new this.flat_struct_constructor(this.buffer,this.elements_offset+this.element_size*e)}constructor(t,e,s,r){super(t,e),this.element_size=s,this.flat_struct_constructor=r}}e.Vector_Direct2=g,e.Array_Direct1_u8=o(f(a)),e.Array_Direct1_i8=o(c(a)),e.Array_Direct1_u16=o(u(a)),e.Array_Direct1_i16=o(l(a)),e.Array_Direct1_u32=o(d(a)),e.Array_Direct1_i32=o(h(a)),e.Array_Direct1_u64=_(p(a)),e.Array_Direct1_i64=_(b(a)),e.Array_Direct1_f32=o(v(a)),e.Array_Direct1_f64=o(m(a));class x extends a{element_size;flat_struct_constructor;*[Symbol.iterator](){let t=this.elements_size;for(let e=0;e<t;++e)yield new this.flat_struct_constructor(this.buffer,this.elements_offset+this.element_size*e)}constructor(t,e,s,r,i){super(t,e,i),this.element_size=s,this.flat_struct_constructor=r}}e.Array_Direct2=x;class w extends(o(f(n))){assign(t){let e=(new TextEncoder).encode(t),s=r(this.buffer,this.offset,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}}e.String_Direct1=w;class y extends s{ut_size;ut_align;constructor(t,e,s,r){super(t,e),this.ut_size=s,this.ut_align=r}get value_offset(){return this.offset+this.buffer.dv.getUint32(this.offset,!0)}alloc(){i(this.buffer,this.offset,this.ut_size,this.ut_align)}get has_value(){return 0!==this.buffer.dv.getUint32(this.offset,!0)}set_nullopt(){this.buffer.dv.setUint32(this.offset,0,!0)}}e.Optional_Direct1_u8=class extends y{get value(){return this.buffer.dv.getUint8(this.value_offset)}set value(t){this.buffer.dv.setUint8(this.value_offset,t)}},e.Optional_Direct1_i8=class extends y{get value(){return this.buffer.dv.getInt8(this.value_offset)}set value(t){this.buffer.dv.setInt8(this.value_offset,t)}},e.Optional_Direct1_u16=class extends y{get value(){return this.buffer.dv.getUint16(this.value_offset,!0)}set value(t){this.buffer.dv.setUint16(this.value_offset,t,!0)}},e.Optional_Direct1_i16=class extends y{get value(){return this.buffer.dv.getInt16(this.value_offset,!0)}set value(t){this.buffer.dv.setInt16(this.value_offset,t,!0)}},e.Optional_Direct1_u32=class extends y{get value(){return this.buffer.dv.getUint32(this.value_offset,!0)}set value(t){this.buffer.dv.setUint32(this.value_offset,t,!0)}},e.Optional_Direct1_i32=class extends y{get value(){return this.buffer.dv.getInt32(this.value_offset,!0)}set value(t){this.buffer.dv.setInt32(this.value_offset,t,!0)}},e.Optional_Direct1_u64=class extends y{get value(){return this.buffer.dv.getBigUint64(this.value_offset,!0)}set value(t){this.buffer.dv.setBigUint64(this.value_offset,t,!0)}},e.Optional_Direct1_i64=class extends y{get value(){return this.buffer.dv.getBigInt64(this.value_offset,!0)}set value(t){this.buffer.dv.setBigInt64(this.value_offset,t,!0)}},e.Optional_Direct1_f32=class extends y{get value(){return this.buffer.dv.getFloat32(this.value_offset,!0)}set value(t){this.buffer.dv.setFloat32(this.value_offset,t,!0)}},e.Optional_Direct1_f64=class extends y{get value(){return this.buffer.dv.getFloat64(this.value_offset,!0)}set value(t){this.buffer.dv.setFloat64(this.value_offset,t,!0)}},e.Optional_Direct2=class extends y{flat_struct_constructor;constructor(t,e,s,r,i){super(t,e,s,r),this.flat_struct_constructor=i}get value(){return new this.flat_struct_constructor(this.buffer,this.value_offset)}}},95:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FlatBuffer=void 0;class s{capacity;size_;array_buffer;dv;static from_array_buffer(t){let e=new s;return e.array_buffer=t,e.size_=e.capacity=t.byteLength,e.dv=new DataView(e.array_buffer),e}static create(t=512){let e=new s;return e.capacity=t,e.size_=0,e.array_buffer=new ArrayBuffer(t),e.dv=new DataView(e.array_buffer),e}prepare(t){if(this.size_+t>this.capacity){this.capacity=Math.max(2*this.capacity,this.capacity+t);let e=new ArrayBuffer(this.capacity);new Uint8Array(e).set(new Uint8Array(this.array_buffer)),this.array_buffer=e,this.dv=new DataView(this.array_buffer)}}consume(t){this.size_-=t}commit(t){this.size_+=t}get offset(){return this.size_}get size(){return this.size_}write_len(t){this.dv.setUint32(0,t,!0)}write_msg_id(t){this.dv.setUint32(4,t,!0)}read_msg_id(){return this.dv.getUint32(4,!0)}write_msg_type(t){this.dv.setUint32(8,t,!0)}read_msg_type(){return this.dv.getUint32(8,!0)}read_exception_number(){return this.dv.getUint32(16,!0)}get writable_view(){return new DataView(this.array_buffer,0,this.size)}set_buffer(t){this.array_buffer=t,this.size_=this.capacity=t.byteLength,this.dv=new DataView(this.array_buffer)}dump(){let t=new String;new Uint8Array(this.array_buffer,0,this.size).forEach((e=>t+=e.toString(16)+" ")),console.log(t)}}e.FlatBuffer=s},607:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.get_nameserver=void 0,i(s(49),e),i(s(787),e),i(s(593),e);const n=s(787),a=s(593);e.get_nameserver=function(t){let e=new n.Nameserver;return e.data.ip4=(0,a.sip4_to_u32)(t),e.data.port=15e3,e.data.websocket_port=15001,e.data.poa_idx=0,e.data.object_id=0n,e.data.flags=0,e.data.class_id=n._INameserver_Servant._get_class(),e}},714:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),i(s(49),e),i(s(593),e)},49:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e},a=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.set_debug_level=e.init=e.create_object_from_flat=e.convert_object_ip=e.narrow=e.oid_create_from_flat=e.handle_standart_reply=e.ReferenceList=e.make_simple_answer=e.ObjectServant=e.ObjectProxy=e.Poa=e.Rpc=e.Connection=e.EndPoint=e.rpc=e.FlatBuffer=e.Flat=void 0;const o=n(s(934));e.Flat=o;const _=s(95);Object.defineProperty(e,"FlatBuffer",{enumerable:!0,get:function(){return _.FlatBuffer}}),a(s(519),e),a(s(49),e),a(s(199),e);const f=s(519),c=s(593),u=s(199),l=16,d=0xffffffffffffffffn,h=2130706433;let p=0;class b{ip4;port;hostname;secured;constructor(t,e,s,r){this.ip4=t,this.port=e,this.hostname=s,this.secured=r}equal(t){return!1===this.secured?this.ip4===t.ip4&&this.port===t.port:this.hostname===t.hostname&&this.port===t.port}}function v(t,s,r){for(;;){let i=e.rpc.get_poa(s);if(!i){(0,e.make_simple_answer)(t,6),console.log("Bad poa index. "+s);break}let n=i.get_object(r);if(!n){(0,e.make_simple_answer)(t,7),console.log("Object not found. "+r);break}return n}return null}e.EndPoint=b;class m{endpoint;ws;queue;async perform_one(){this.ws.send(this.queue[0].buffer.writable_view)}on_open(){this.queue.length&&this.perform_one()}async send_receive(t,e){let s=new c.MyPromise;return this.queue.push({buffer:t,promise:s}),this.ws.readyState&&1==this.queue.length&&this.perform_one(),s.$}on_read(t){let s=_.FlatBuffer.from_array_buffer(t.data);if(1==s.read_msg_type()){let e=this.queue[0];e.buffer.set_buffer(t.data),this.queue.shift(),e.promise.set_promise(),this.queue.length&&this.perform_one()}else{switch(s.read_msg_id()){case 0:{let t=new u.impl.Flat_nprpc_base.CallHeader_Direct(s,l);p>=2&&console.log("FunctionCall. interface_idx: "+t.interface_idx+" , fn_idx: "+t.function_idx+" , poa_idx: "+t.poa_idx+" , oid: "+t.object_id);let e=v(s,t.poa_idx,t.object_id);e&&e.dispatch(s,this.endpoint,!1);break}case 2:{let t=new u.detail.Flat_nprpc_base.ObjectIdLocal_Direct(s,l);p>=2&&console.log("AddReference. poa_idx: "+t.poa_idx+" , oid: "+t.object_id),v(s,t.poa_idx,t.object_id)&&(0,e.make_simple_answer)(s,4);break}case 3:new u.detail.Flat_nprpc_base.ObjectIdLocal_Direct(s,l);break;default:(0,e.make_simple_answer)(s,10)}this.ws.send(s.writable_view)}}on_close(){}on_error(t){}constructor(t){this.endpoint=t,this.queue=new Array,e.rpc.host_info.secured?this.ws=new WebSocket("wss://"+this.endpoint.hostname+":"+this.endpoint.port.toString(10)):this.ws=new WebSocket("ws://"+(0,c.ip4tostr)(this.endpoint.ip4)+":"+this.endpoint.port.toString(10)),this.ws.binaryType="arraybuffer",this.ws.onopen=this.on_open.bind(this),this.ws.onclose=this.on_close.bind(this),this.ws.onmessage=this.on_read.bind(this),this.ws.onerror=this.on_error.bind(this)}}e.Connection=m;class g{host_info;last_poa_id_;opened_connections_;poa_list_;get_connection(t){let e=this.opened_connections_.find((e=>e.endpoint.equal(t)));if(e)return e;let s=new m(t);return this.opened_connections_.push(s),s}create_poa(t){let e=new j(this.last_poa_id_++,t);return this.poa_list_.push(e),e}get_poa(t){return t>=this.poa_list_.length||t<0?null:this.poa_list_[t]}async call(t,e,s=2500){return this.get_connection(t).send_receive(e,s)}static async read_host(){let t=await fetch("./host.json");if(!t.ok)throw"read_host error: "+t.statusText;let e=JSON.parse(await t.text(),((t,e)=>"object_id"===t?BigInt(e):e));null==e.secured&&(e.secured=!1);for(let t of Object.keys(e.objects))e.objects[t]=new D(e.objects[t]);return e}constructor(t){this.last_poa_id_=0,this.opened_connections_=new Array,this.poa_list_=new Array,this.host_info=t}}e.Rpc=g;const x=t=>Number(0xffffffffn&t),w=t=>Number(t>>32n);class y{max_size_;data_;tail_idx_;add(t){let e=this.tail_idx_;if(e==this.max_size_)return d;let s=this.data_[this.tail_idx_];return this.tail_idx_=x(s.oid),s.obj=t,BigInt(e)|BigInt(w(s.oid))<<32n}remove(t){let e=x(t);this.data_[e].oid=BigInt(this.tail_idx_)|BigInt(w(t)+1),this.data_[e].obj=null,this.tail_idx_=e}get(t){let e=x(t);if(e>=this.max_size_)return null;let s=this.data_[e];return w(s.oid)!=w(t)?null:s.obj}constructor(t){this.max_size_=t,this.data_=new Array(this.max_size_);for(let t=0;t<this.max_size_;++t)this.data_[t]={oid:BigInt(t+1),obj:null};Object.seal(this.data_),this.tail_idx_=0}}class j{object_map_;index_;get index(){return this.index_}get_object(t){return this.object_map_.get(t)}activate_object(t){t.poa_=this,t.activation_time_=Date.now();let e=this.object_map_.add(t);if(e===d)throw new f.Exception("Poa fixed size has been exceeded");return t.object_id_=e,t.ref_cnt_=1,{object_id:e,ip4:h,port:0,websocket_port:0,poa_idx:this.index,flags:2,class_id:t.get_class(),hostname:""}}deactivate_object(t){}constructor(t,e){this.index_=t,this.object_map_=new y(e)}}e.Poa=j;class D{data;local_ref_cnt_;timeout_ms_;endpoint_;constructor(t){this.data=t||new Object,this.timeout_ms_=1e3,this.local_ref_cnt_=1}endpoint(){return void 0!==this.endpoint_?this.endpoint_:this.endpoint_=new b(this.data.ip4,this.data.websocket_port,this.data.hostname,0!=(4&this.data.flags))}get timeout(){return this.timeout_ms_}add_ref(){if(this.local_ref_cnt_++,1!=this.local_ref_cnt_)return this.local_ref_cnt_;let t=_.FlatBuffer.create(32);t.write_len(28),t.write_msg_id(2),t.write_msg_type(0);let s=new u.detail.Flat_nprpc_base.ObjectIdLocal_Direct(t,l);return s.poa_idx=this.data.poa_idx,s.object_id=this.data.object_id,t.commit(32),e.rpc.call(this.endpoint(),t,this.timeout).then().catch(),this.local_ref_cnt_}release(){if(0!=--this.local_ref_cnt_)return this.local_ref_cnt_;let t=_.FlatBuffer.create(32);t.write_len(28),t.write_msg_id(3),t.write_msg_type(0);let s=new u.detail.Flat_nprpc_base.ObjectIdLocal_Direct(t,l);return s.poa_idx=this.data.poa_idx,s.object_id=this.data.object_id,t.commit(32),e.rpc.call(this.endpoint(),t,this.timeout).then().catch(),0}}e.ObjectProxy=D,e.ObjectServant=class{poa_;object_id_;activation_time_;ref_cnt_;get poa(){return this.poa_}get oid(){return this.object_id_}add_ref(){return++this.ref_cnt_}constructor(){this.ref_cnt_=0}},e.make_simple_answer=(t,e)=>{t.consume(t.size),t.prepare(l),t.write_len(12),t.write_msg_id(e),t.write_msg_type(1),t.commit(l)},e.ReferenceList=class{refs;add_ref(t){this.refs.push({object_id:{poa_idx:t.poa.index,object_id:t.oid},obj:t}),t.add_ref()}remove_ref(t,e){return!1}constructor(){this.refs=new Array}},e.handle_standart_reply=t=>{switch(t.read_msg_id()){case 4:return 0;case 5:return 1;case 7:throw new u.ExceptionObjectNotExist;case 8:throw new u.ExceptionCommFailure;case 9:throw new u.ExceptionUnknownFunctionIndex;case 10:throw new u.ExceptionUnknownMessageId;case 11:throw new u.ExceptionBadAccess;default:return-1}},e.oid_create_from_flat=t=>({object_id:t.object_id,ip4:t.ip4,port:t.port,websocket_port:t.websocket_port,poa_idx:t.poa_idx,flags:t.flags,class_id:t.class_id,hostname:t.hostname}),e.narrow=(t,e)=>{if(t.data.class_id!==e.servant_t._get_class())return null;let s=new e;return s.data=t.data,s.local_ref_cnt_=t.local_ref_cnt_,s.timeout_ms_=t.timeout_ms_,t.data=null,t.local_ref_cnt_=0,s},e.convert_object_ip=(t,s)=>{if(s==h||t.ip4==h&&(t.ip4=s),e.rpc.host_info.secured&&!(4&t.flags))throw new u.ExceptionUnsecuredObject(t.class_id);return t},e.create_object_from_flat=(t,s)=>{if(t.object_id==d)return null;let r=new D;return r.local_ref_cnt_=1,r.data.object_id=t.object_id,r.data.ip4=t.ip4,r.data.port=t.port,r.data.websocket_port=t.websocket_port,r.data.poa_idx=t.poa_idx,r.data.flags=t.flags,r.data.class_id=t.class_id,r.data.hostname=t.hostname,(0,e.convert_object_ip)(r.data,s),r},e.init=async()=>void 0!==e.rpc?e.rpc:e.rpc=new g(await g.read_host()),e.set_debug_level=t=>{p=t}},199:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.impl=e.detail=e.ExceptionBadInput=e.ExceptionBadAccess=e.ExceptionUnsecuredObject=e.ExceptionUnknownMessageId=e.ExceptionUnknownFunctionIndex=e.ExceptionObjectNotExist=e.ExceptionTimeout=e.Flat_nprpc_base=e.ExceptionCommFailure=void 0;const a=n(s(653)),o=new TextEncoder,_=new TextDecoder;class f extends a.Exception{constructor(){super("ExceptionCommFailure")}}e.ExceptionCommFailure=f,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionCommFailure_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class c extends a.Exception{constructor(){super("ExceptionTimeout")}}e.ExceptionTimeout=c,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionTimeout_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class u extends a.Exception{constructor(){super("ExceptionObjectNotExist")}}e.ExceptionObjectNotExist=u,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionObjectNotExist_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class l extends a.Exception{constructor(){super("ExceptionUnknownFunctionIndex")}}e.ExceptionUnknownFunctionIndex=l,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionUnknownFunctionIndex_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class d extends a.Exception{constructor(){super("ExceptionUnknownMessageId")}}e.ExceptionUnknownMessageId=d,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionUnknownMessageId_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class h extends a.Exception{class_id;constructor(t){super("ExceptionUnsecuredObject"),this.class_id=t}}e.ExceptionUnsecuredObject=h,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}get class_id(){const t=this.offset+4,e=this.buffer.dv.getUint32(t+4,!0);return e>0?_.decode(new DataView(this.buffer.array_buffer,t+this.buffer.dv.getUint32(t,!0),e)):""}set class_id(t){const e=o.encode(t),s=a.Flat._alloc(this.buffer,this.offset+4,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}}t.ExceptionUnsecuredObject_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class p extends a.Exception{constructor(){super("ExceptionBadAccess")}}e.ExceptionBadAccess=p,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionBadAccess_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={}));class b extends a.Exception{constructor(){super("ExceptionBadInput")}}e.ExceptionBadInput=b,function(t){class e extends a.Flat.Flat{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}}t.ExceptionBadInput_Direct=e}(e.Flat_nprpc_base||(e.Flat_nprpc_base={})),function(t){let e;!function(t){class e extends a.Flat.Flat{get poa_idx(){return this.buffer.dv.getUint16(this.offset+0,!0)}set poa_idx(t){this.buffer.dv.setUint16(this.offset+0,t,!0)}get object_id(){return this.buffer.dv.getBigUint64(this.offset+8,!0)}set object_id(t){this.buffer.dv.setBigUint64(this.offset+8,t,!0)}}t.ObjectIdLocal_Direct=e}(e=t.Flat_nprpc_base||(t.Flat_nprpc_base={})),function(t){class e extends a.Flat.Flat{get object_id(){return this.buffer.dv.getBigUint64(this.offset+0,!0)}set object_id(t){this.buffer.dv.setBigUint64(this.offset+0,t,!0)}get ip4(){return this.buffer.dv.getUint32(this.offset+8,!0)}set ip4(t){this.buffer.dv.setUint32(this.offset+8,t,!0)}get port(){return this.buffer.dv.getUint16(this.offset+12,!0)}set port(t){this.buffer.dv.setUint16(this.offset+12,t,!0)}get websocket_port(){return this.buffer.dv.getUint16(this.offset+14,!0)}set websocket_port(t){this.buffer.dv.setUint16(this.offset+14,t,!0)}get poa_idx(){return this.buffer.dv.getUint16(this.offset+16,!0)}set poa_idx(t){this.buffer.dv.setUint16(this.offset+16,t,!0)}get flags(){return this.buffer.dv.getUint32(this.offset+20,!0)}set flags(t){this.buffer.dv.setUint32(this.offset+20,t,!0)}get class_id(){const t=this.offset+24,e=this.buffer.dv.getUint32(t+4,!0);return e>0?_.decode(new DataView(this.buffer.array_buffer,t+this.buffer.dv.getUint32(t,!0),e)):""}set class_id(t){const e=o.encode(t),s=a.Flat._alloc(this.buffer,this.offset+24,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}get hostname(){const t=this.offset+32,e=this.buffer.dv.getUint32(t+4,!0);return e>0?_.decode(new DataView(this.buffer.array_buffer,t+this.buffer.dv.getUint32(t,!0),e)):""}set hostname(t){const e=o.encode(t),s=a.Flat._alloc(this.buffer,this.offset+32,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}}t.ObjectId_Direct=e}(e=t.Flat_nprpc_base||(t.Flat_nprpc_base={}))}(e.detail||(e.detail={})),function(t){let e;!function(t){class e extends a.Flat.Flat{get size(){return this.buffer.dv.getUint32(this.offset+0,!0)}set size(t){this.buffer.dv.setUint32(this.offset+0,t,!0)}get msg_id(){return this.buffer.dv.getUint32(this.offset+4,!0)}set msg_id(t){this.buffer.dv.setUint32(this.offset+4,t,!0)}get msg_type(){return this.buffer.dv.getUint32(this.offset+8,!0)}set msg_type(t){this.buffer.dv.setUint32(this.offset+8,t,!0)}get reserved(){return this.buffer.dv.getUint32(this.offset+12,!0)}set reserved(t){this.buffer.dv.setUint32(this.offset+12,t,!0)}}t.Header_Direct=e}(e=t.Flat_nprpc_base||(t.Flat_nprpc_base={})),function(t){class e extends a.Flat.Flat{get poa_idx(){return this.buffer.dv.getUint16(this.offset+0,!0)}set poa_idx(t){this.buffer.dv.setUint16(this.offset+0,t,!0)}get interface_idx(){return this.buffer.dv.getUint8(this.offset+2)}set interface_idx(t){this.buffer.dv.setUint8(this.offset+2,t)}get function_idx(){return this.buffer.dv.getUint8(this.offset+3)}set function_idx(t){this.buffer.dv.setUint8(this.offset+3,t)}get object_id(){return this.buffer.dv.getBigUint64(this.offset+8,!0)}set object_id(t){this.buffer.dv.setBigUint64(this.offset+8,t,!0)}}t.CallHeader_Direct=e}(e=t.Flat_nprpc_base||(t.Flat_nprpc_base={}))}(e.impl||(e.impl={}))},787:function(t,e,s){var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Flat_nprpc_nameserver=e._INameserver_Servant=e.Nameserver=void 0;const a=n(s(714)),o=new TextEncoder,_=new TextDecoder;class f extends a.ObjectProxy{static get servant_t(){return c}async Bind(t,e){let s=2==arguments.length?0:arguments[arguments.length-1],r=a.FlatBuffer.create();r.prepare(208),r.commit(80),r.write_msg_id(0),r.write_msg_type(0);let i=new a.impl.Flat_nprpc_base.CallHeader_Direct(r,16);i.object_id=this.data.object_id,i.poa_idx=this.data.poa_idx,i.interface_idx=s,i.function_idx=0;let n=new u.nprpc_nameserver_M1_Direct(r,32);n._1.object_id=t.object_id,n._1.ip4=t.ip4,n._1.port=t.port,n._1.websocket_port=t.websocket_port,n._1.poa_idx=t.poa_idx,n._1.flags=t.flags,n._1.class_id=t.class_id,n._1.hostname=t.hostname,n._2=e,r.write_len(r.size-4),await a.rpc.call(this.endpoint(),r,this.timeout),0!=a.handle_standart_reply(r)&&console.log("received an unusual reply for function with no output arguments")}async Resolve(t,e){let s=2==arguments.length?0:arguments[arguments.length-1],r=a.FlatBuffer.create();r.prepare(168),r.commit(40),r.write_msg_id(0),r.write_msg_type(0);let i=new a.impl.Flat_nprpc_base.CallHeader_Direct(r,16);if(i.object_id=this.data.object_id,i.poa_idx=this.data.poa_idx,i.interface_idx=s,i.function_idx=1,new u.nprpc_nameserver_M2_Direct(r,32)._1=t,r.write_len(r.size-4),await a.rpc.call(this.endpoint(),r,this.timeout),-1!=a.handle_standart_reply(r))throw console.log("received an unusual reply for function with output arguments"),new a.Exception("Unknown Error");let n,o=new u.nprpc_nameserver_M3_Direct(r,16);return e.value=a.create_object_from_flat(o._2,this.data.ip4),n=o._1,n}}e.Nameserver=f;class c extends a.ObjectServant{static _get_class(){return"nprpc_nameserver/nprpc.Nameserver"}get_class=()=>c._get_class();dispatch=(t,e,s)=>{c._dispatch(this,t,e,s)};static _dispatch(t,e,s,r){switch(new a.impl.Flat_nprpc_base.CallHeader_Direct(e,16).function_idx){case 0:{let r=new u.nprpc_nameserver_M1_Direct(e,32);t.Bind(a.create_object_from_flat(r._1,s.ip4),r._2),a.make_simple_answer(e,4);break}case 1:{let s=new u.nprpc_nameserver_M2_Direct(e,32),r=e;r.consume(r.size),r.prepare(192),r.commit(64);let i,n=new u.nprpc_nameserver_M3_Direct(r,16);i=t.Resolve(s._1,n._2),n._1=i,r.write_len(r.size-4),r.write_msg_id(1),r.write_msg_type(1);break}default:a.make_simple_answer(e,9)}}}var u;e._INameserver_Servant=c,function(t){class e extends a.Flat.Flat{get _1(){return new a.detail.Flat_nprpc_base.ObjectId_Direct(this.buffer,this.offset+0)}get _2(){const t=this.offset+40,e=this.buffer.dv.getUint32(t+4,!0);return e>0?_.decode(new DataView(this.buffer.array_buffer,t+this.buffer.dv.getUint32(t,!0),e)):""}set _2(t){const e=o.encode(t),s=a.Flat._alloc(this.buffer,this.offset+40,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}}t.nprpc_nameserver_M1_Direct=e}(u=e.Flat_nprpc_nameserver||(e.Flat_nprpc_nameserver={})),function(t){class e extends a.Flat.Flat{get _1(){const t=this.offset+0,e=this.buffer.dv.getUint32(t+4,!0);return e>0?_.decode(new DataView(this.buffer.array_buffer,t+this.buffer.dv.getUint32(t,!0),e)):""}set _1(t){const e=o.encode(t),s=a.Flat._alloc(this.buffer,this.offset+0,e.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(e)}}t.nprpc_nameserver_M2_Direct=e}(u=e.Flat_nprpc_nameserver||(e.Flat_nprpc_nameserver={})),function(t){class e extends a.Flat.Flat{get _1(){return 1===this.buffer.dv.getUint8(this.offset+0)}set _1(t){this.buffer.dv.setUint8(this.offset+0,!0===t?1:0)}get _2(){return new a.detail.Flat_nprpc_base.ObjectId_Direct(this.buffer,this.offset+8)}}t.nprpc_nameserver_M3_Direct=e}(u=e.Flat_nprpc_nameserver||(e.Flat_nprpc_nameserver={}))},593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MyPromise=e.ip4tostr=e.sip4_to_u32=e.make_ref=void 0,e.make_ref=function(){return{value:void 0}},e.sip4_to_u32=t=>{let e=/(\d+)\.(\d+)\.(\d+)\.(\d+)/gi.exec(t);if(5!=e.length)throw"ip address is incorrect";return Number(e[1])<<24|Number(e[2])<<16|Number(e[3])<<8|Number(e[4])},e.ip4tostr=t=>(t>>24&255)+"."+(t>>16&255)+"."+(t>>8&255)+"."+(255&t),e.MyPromise=class{actual_promise_;resolve_;reject_;constructor(){this.actual_promise_=new Promise(((t,e)=>{this.resolve_=e=>{t(e)},this.reject_=t=>{e(t)}}))}get $(){return this.actual_promise_}set_promise(t){this.resolve_(t)}set_exception(t){this.reject_(t)}}}},e={};return function s(r){var i=e[r];if(void 0!==i)return i.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,s),n.exports}(607)})()));