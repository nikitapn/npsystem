var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Array_Direct1_f32:()=>q,Array_Direct1_f64:()=>C,Array_Direct1_i16:()=>B,Array_Direct1_i32:()=>S,Array_Direct1_i64:()=>V,Array_Direct1_i8:()=>F,Array_Direct1_u16:()=>M,Array_Direct1_u32:()=>k,Array_Direct1_u64:()=>T,Array_Direct1_u8:()=>O,Array_Direct2:()=>R,Flat:()=>s,Optional_Direct1_Vector_boolean:()=>te,Optional_Direct1_Vector_f32:()=>ae,Optional_Direct1_Vector_f64:()=>_e,Optional_Direct1_Vector_i16:()=>ie,Optional_Direct1_Vector_i32:()=>fe,Optional_Direct1_Vector_i8:()=>se,Optional_Direct1_Vector_u16:()=>re,Optional_Direct1_Vector_u32:()=>ne,Optional_Direct1_Vector_u8:()=>ee,Optional_Direct1_boolean:()=>W,Optional_Direct1_f32:()=>Y,Optional_Direct1_f64:()=>Z,Optional_Direct1_i16:()=>J,Optional_Direct1_i32:()=>K,Optional_Direct1_i64:()=>X,Optional_Direct1_i8:()=>H,Optional_Direct1_u16:()=>$,Optional_Direct1_u32:()=>G,Optional_Direct1_u64:()=>Q,Optional_Direct1_u8:()=>P,Optional_Direct2:()=>oe,String_Direct1:()=>L,Vector_Direct1_f32:()=>A,Vector_Direct1_f64:()=>E,Vector_Direct1_i16:()=>x,Vector_Direct1_i32:()=>D,Vector_Direct1_i64:()=>j,Vector_Direct1_i8:()=>v,Vector_Direct1_u16:()=>w,Vector_Direct1_u32:()=>U,Vector_Direct1_u64:()=>I,Vector_Direct1_u8:()=>m,Vector_Direct2:()=>z,_alloc:()=>r,_alloc1:()=>i});class s{constructor(e,t){this.buffer=e,this.offset=t}}function r(e,t,s,r,i){if(0==s)return e.dv.setUint32(t,0,!0),e.dv.setUint32(t+4,0,!0),0;let n=e.offset%i,f=n?e.offset+(i-n):e.offset;{let t=s*r+(f-e.offset);e.prepare(t),e.commit(t)}return e.dv.setUint32(t,f-t,!0),e.dv.setUint32(t+4,s,!0),f}function i(e,t,s,r){let i=e.offset%r,n=i?e.offset+(r-i):e.offset;{let t=s+(n-e.offset);e.prepare(t),e.commit(t)}return e.dv.setUint32(t,n-t,!0),n}class n extends s{get elements_offset(){return this.offset+this.buffer.dv.getUint32(this.offset,!0)}get elements_size(){return this.buffer.dv.getUint32(this.offset+4,!0)}}class f extends s{constructor(e,t,s){super(e,t),this.buffer=e,this.offset=t,this.size=s}get elements_offset(){return this.offset}get elements_size(){return this.size}}function a(e){return class extends e{[Symbol.iterator](){let e=this;const t=e.elements_size;let s=0;return{next:()=>s<t?{value:e.at(s++),done:!1}:{value:t,done:!0}}}}}function _(e){return class extends e{[Symbol.iterator](){let e=this;const t=e.elements_size;let s=0;return{next:()=>s<t?{value:e.at(s++),done:!1}:{value:t,done:!0}}}}}function o(e){return class extends e{at(e){return this.buffer.dv.getUint8(this.elements_offset+e)}set(e,t){this.buffer.dv.setUint8(this.elements_offset+e,t)}copy_from_typed_array(e){new Uint8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Uint8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Uint8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}get array_buffer(){let e=this.elements_offset;return this.buffer.array_buffer.slice(e,e+this.elements_size)}get data_view(){return new DataView(this.buffer.array_buffer,this.elements_offset)}}}function u(e){return class extends e{at(e){return this.buffer.dv.getInt8(this.elements_offset+e)}set(e,t){this.buffer.dv.setInt8(this.elements_offset+e,t)}copy_from_typed_array(e){new Int8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Int8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Int8Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function c(e){return class extends e{at(e){return this.buffer.dv.getUint16(this.elements_offset+2*e,!0)}set(e,t){this.buffer.dv.setUint16(this.elements_offset+2*e,t,!0)}copy_from_typed_array(e){new Uint16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Uint16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Uint16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function l(e){return class extends e{at(e){return this.buffer.dv.getInt16(this.elements_offset+2*e,!0)}set(e,t){this.buffer.dv.setInt16(this.elements_offset+2*e,t,!0)}copy_from_typed_array(e){new Int16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Int16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Int16Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function h(e){return class extends e{at(e){return this.buffer.dv.getUint32(this.elements_offset+4*e,!0)}set(e,t){this.buffer.dv.setUint32(this.elements_offset+4*e,t,!0)}copy_from_typed_array(e){new Uint32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Uint32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Uint32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function d(e){return class extends e{at(e){return this.buffer.dv.getInt32(this.elements_offset+4*e,!0)}set(e,t){this.buffer.dv.setInt32(this.elements_offset+4*e,t,!0)}copy_from_typed_array(e){new Int32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Int32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Int32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function b(e){return class extends e{at(e){return this.buffer.dv.getBigUint64(this.elements_offset+8*e,!0)}set(e,t){this.buffer.dv.setBigUint64(this.elements_offset+8*e,t,!0)}copy_from_typed_array(e){new BigUint64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new BigUint64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new BigUint64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function p(e){return class extends e{at(e){return this.buffer.dv.getBigInt64(this.elements_offset+8*e,!0)}set(e,t){this.buffer.dv.setBigInt64(this.elements_offset+8*e,t,!0)}copy_from_typed_array(e){new BigInt64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new BigInt64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new BigInt64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function g(e){return class extends e{at(e){return this.buffer.dv.getFloat32(this.elements_offset+4*e,!0)}set(e,t){this.buffer.dv.setFloat32(this.elements_offset+4*e,t,!0)}copy_from_typed_array(e){new Float32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Float32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Float32Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}function y(e){return class extends e{at(e){return this.buffer.dv.getFloat64(this.elements_offset+8*e,!0)}set(e,t){this.buffer.dv.setFloat64(this.elements_offset+8*e,t,!0)}copy_from_typed_array(e){new Float64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}copy_from_ts_array(e){new Float64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size).set(e)}get typed_array(){return new Float64Array(this.buffer.array_buffer,this.elements_offset,this.elements_size)}get array(){return Array.from(this.typed_array)}}}const m=a(o(n)),v=a(u(n)),w=a(c(n)),x=a(l(n)),U=a(h(n)),D=a(d(n)),I=_(b(n)),j=_(p(n)),A=a(g(n)),E=a(y(n));class z extends n{constructor(e,t,s,r){super(e,t),this.element_size=s,this.flat_struct_constructor=r}*[Symbol.iterator](){let e=this.elements_size;for(let t=0;t<e;++t)yield new this.flat_struct_constructor(this.buffer,this.elements_offset+this.element_size*t)}}const O=a(o(f)),F=a(u(f)),M=a(c(f)),B=a(l(f)),k=a(h(f)),S=a(d(f)),T=_(b(f)),V=_(p(f)),q=a(g(f)),C=a(y(f));class R extends f{constructor(e,t,s,r,i){super(e,t,i),this.element_size=s,this.flat_struct_constructor=r}*[Symbol.iterator](){let e=this.elements_size;for(let t=0;t<e;++t)yield new this.flat_struct_constructor(this.buffer,this.elements_offset+this.element_size*t)}}class L extends(a(o(n))){assign(e){let t=(new TextEncoder).encode(e),s=r(this.buffer,this.offset,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}class N extends s{constructor(e,t,s,r){super(e,t),this.ut_size=s,this.ut_align=r}get value_offset(){return this.offset+this.buffer.dv.getUint32(this.offset,!0)}alloc(){i(this.buffer,this.offset,this.ut_size,this.ut_align)}get has_value(){return 0!==this.buffer.dv.getUint32(this.offset,!0)}set_nullopt(){this.buffer.dv.setUint32(this.offset,0,!0)}}class P extends N{get value(){return this.buffer.dv.getUint8(this.value_offset)}set value(e){this.buffer.dv.setUint8(this.value_offset,e)}}class W extends N{get value(){return 1===this.buffer.dv.getUint8(this.value_offset)}set value(e){this.buffer.dv.setUint8(this.value_offset,!0===e?1:0)}}class H extends N{get value(){return this.buffer.dv.getInt8(this.value_offset)}set value(e){this.buffer.dv.setInt8(this.value_offset,e)}}class $ extends N{get value(){return this.buffer.dv.getUint16(this.value_offset,!0)}set value(e){this.buffer.dv.setUint16(this.value_offset,e,!0)}}class J extends N{get value(){return this.buffer.dv.getInt16(this.value_offset,!0)}set value(e){this.buffer.dv.setInt16(this.value_offset,e,!0)}}class G extends N{get value(){return this.buffer.dv.getUint32(this.value_offset,!0)}set value(e){this.buffer.dv.setUint32(this.value_offset,e,!0)}}class K extends N{get value(){return this.buffer.dv.getInt32(this.value_offset,!0)}set value(e){this.buffer.dv.setInt32(this.value_offset,e,!0)}}class Q extends N{get value(){return this.buffer.dv.getBigUint64(this.value_offset,!0)}set value(e){this.buffer.dv.setBigUint64(this.value_offset,e,!0)}}class X extends N{get value(){return this.buffer.dv.getBigInt64(this.value_offset,!0)}set value(e){this.buffer.dv.setBigInt64(this.value_offset,e,!0)}}class Y extends N{get value(){return this.buffer.dv.getFloat32(this.value_offset,!0)}set value(e){this.buffer.dv.setFloat32(this.value_offset,e,!0)}}class Z extends N{get value(){return this.buffer.dv.getFloat64(this.value_offset,!0)}set value(e){this.buffer.dv.setFloat64(this.value_offset,e,!0)}}class ee extends N{value(e){r(this.buffer,this.value_offset,e,1,1)}value_d(){return new m(this.buffer,this.value_offset)}}const te=ee;class se extends N{value(e){r(this.buffer,this.value_offset,e,1,1)}value_d(){return new v(this.buffer,this.value_offset)}}class re extends N{value(e){r(this.buffer,this.value_offset,e,2,2)}value_d(){return new w(this.buffer,this.value_offset)}}class ie extends N{value(e){r(this.buffer,this.value_offset,e,2,2)}value_d(){return new x(this.buffer,this.value_offset)}}class ne extends N{value(e){r(this.buffer,this.value_offset,e,4,4)}value_d(){return new U(this.buffer,this.value_offset)}}class fe extends N{value(e){r(this.buffer,this.value_offset,e,4,4)}value_d(){return new D(this.buffer,this.value_offset)}}class ae extends N{value(e){r(this.buffer,this.value_offset,e,4,4)}value_d(){return new A(this.buffer,this.value_offset)}}class _e extends N{value(e){r(this.buffer,this.value_offset,e,8,8)}value_d(){return new E(this.buffer,this.value_offset)}}class oe extends N{constructor(e,t,s,r,i){super(e,t,s,r),this.flat_struct_constructor=i}get value(){return new this.flat_struct_constructor(this.buffer,this.value_offset)}}class ue{static from_array_buffer(e){let t=new ue;return t.array_buffer=e,t.size_=t.capacity=e.byteLength,t.dv=new DataView(t.array_buffer),t}static create(e=512){let t=new ue;return t.capacity=e,t.size_=0,t.array_buffer=new ArrayBuffer(e),t.dv=new DataView(t.array_buffer),t}prepare(e){if(this.size_+e>this.capacity){this.capacity=Math.max(2*this.capacity,this.capacity+e);let t=new ArrayBuffer(this.capacity);new Uint8Array(t).set(new Uint8Array(this.array_buffer)),this.array_buffer=t,this.dv=new DataView(this.array_buffer)}}consume(e){this.size_-=e}commit(e){this.size_+=e}get offset(){return this.size_}get size(){return this.size_}write_len(e){this.dv.setUint32(0,e,!0)}write_msg_id(e){this.dv.setUint32(4,e,!0)}read_msg_id(){return this.dv.getUint32(4,!0)}write_msg_type(e){this.dv.setUint32(8,e,!0)}read_msg_type(){return this.dv.getUint32(8,!0)}read_exception_number(){return this.dv.getUint32(16,!0)}write_request_id(e){this.dv.setUint32(12,e,!0)}read_request_id(){return this.dv.getUint32(12,!0)}get writable_view(){return new DataView(this.array_buffer,0,this.size)}set_buffer(e){this.array_buffer=e,this.size_=this.capacity=e.byteLength,this.dv=new DataView(this.array_buffer)}dump(){let e=new String;new Uint8Array(this.array_buffer,0,this.size).forEach((t=>e+=t.toString(16)+" ")),console.log(e)}}class ce extends Error{constructor(e){super(e)}}function le(){return{value:void 0}}const he=e=>{let t=/(\d+)\.(\d+)\.(\d+)\.(\d+)/gi.exec(e);if(5!=t.length)throw"ip address is incorrect";return Number(t[1])<<24|Number(t[2])<<16|Number(t[3])<<8|Number(t[4])},de=e=>(e>>24&255)+"."+(e>>16&255)+"."+(e>>8&255)+"."+(255&e);class be{constructor(){this.actual_promise_=new Promise(((e,t)=>{this.resolve_=t=>{e(t)},this.reject_=e=>{t(e)}}))}get $(){return this.actual_promise_}set_promise(e){this.resolve_(e)}set_exception(e){this.reject_(e)}}const pe=new TextEncoder,ge=new TextDecoder;class ye extends ce{constructor(e){super("ExceptionCommFailure"),this.what=e}}var me,ve,we,xe,Ue;!function(e){e.ExceptionCommFailure_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}get what(){const e=this.offset+4,t=this.buffer.dv.getUint32(e+4,!0);return t>0?ge.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set what(e){const t=pe.encode(e),s=r(this.buffer,this.offset+4,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}}(me||(me={}));class De extends ce{constructor(){super("ExceptionTimeout")}}!function(e){e.ExceptionTimeout_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={}));class Ie extends ce{constructor(){super("ExceptionObjectNotExist")}}!function(e){e.ExceptionObjectNotExist_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={}));class je extends ce{constructor(){super("ExceptionUnknownFunctionIndex")}}!function(e){e.ExceptionUnknownFunctionIndex_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={}));class Ae extends ce{constructor(){super("ExceptionUnknownMessageId")}}!function(e){e.ExceptionUnknownMessageId_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={}));class Ee extends ce{constructor(e){super("ExceptionUnsecuredObject"),this.class_id=e}}!function(e){e.ExceptionUnsecuredObject_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}get class_id(){const e=this.offset+4,t=this.buffer.dv.getUint32(e+4,!0);return t>0?ge.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set class_id(e){const t=pe.encode(e),s=r(this.buffer,this.offset+4,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}}(me||(me={}));class ze extends ce{constructor(){super("ExceptionBadAccess")}}!function(e){e.ExceptionBadAccess_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={}));class Oe extends ce{constructor(){super("ExceptionBadInput")}}!function(e){e.ExceptionBadInput_Direct=class extends s{get __ex_id(){return this.buffer.dv.getUint32(this.offset+0,!0)}set __ex_id(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}}}(me||(me={})),function(e){e[e.DebugLevel_Critical=0]="DebugLevel_Critical",e[e.DebugLevel_InactiveTimeout=1]="DebugLevel_InactiveTimeout",e[e.DebugLevel_EveryCall=2]="DebugLevel_EveryCall",e[e.DebugLevel_EveryMessageContent=3]="DebugLevel_EveryMessageContent",e[e.DebugLevel_TraceAll=4]="DebugLevel_TraceAll"}(ve||(ve={})),function(e){e[e.Tcp=0]="Tcp",e[e.TcpTethered=1]="TcpTethered",e[e.WebSocket=2]="WebSocket",e[e.SecuredWebSocket=3]="SecuredWebSocket",e[e.SharedMemory=4]="SharedMemory"}(we||(we={})),function(e){let t,i;!function(e){e.ObjectIdLocal_Direct=class extends s{get poa_idx(){return this.buffer.dv.getUint16(this.offset+0,!0)}set poa_idx(e){this.buffer.dv.setUint16(this.offset+0,e,!0)}get object_id(){return this.buffer.dv.getBigUint64(this.offset+8,!0)}set object_id(e){this.buffer.dv.setBigUint64(this.offset+8,e,!0)}}}(t=e.Flat_nprpc_base||(e.Flat_nprpc_base={})),function(e){e[e.Persistent=1]="Persistent",e[e.Tethered=2]="Tethered"}(i=e.ObjectFlag||(e.ObjectFlag={})),function(e){e.ObjectId_Direct=class extends s{get object_id(){return this.buffer.dv.getBigUint64(this.offset+0,!0)}set object_id(e){this.buffer.dv.setBigUint64(this.offset+0,e,!0)}get poa_idx(){return this.buffer.dv.getUint16(this.offset+8,!0)}set poa_idx(e){this.buffer.dv.setUint16(this.offset+8,e,!0)}get flags(){return this.buffer.dv.getUint16(this.offset+10,!0)}set flags(e){this.buffer.dv.setUint16(this.offset+10,e,!0)}origin_d(){return new O(this.buffer,this.offset+12,16)}get class_id(){const e=this.offset+28,t=this.buffer.dv.getUint32(e+4,!0);return t>0?ge.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set class_id(e){const t=pe.encode(e),s=r(this.buffer,this.offset+28,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}get urls(){const e=this.offset+36,t=this.buffer.dv.getUint32(e+4,!0);return t>0?ge.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set urls(e){const t=pe.encode(e),s=r(this.buffer,this.offset+36,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}}(t=e.Flat_nprpc_base||(e.Flat_nprpc_base={}))}(xe||(xe={})),function(e){let t,r,i;!function(e){e[e.FunctionCall=0]="FunctionCall",e[e.BlockResponse=1]="BlockResponse",e[e.AddReference=2]="AddReference",e[e.ReleaseObject=3]="ReleaseObject",e[e.Success=4]="Success",e[e.Exception=5]="Exception",e[e.Error_PoaNotExist=6]="Error_PoaNotExist",e[e.Error_ObjectNotExist=7]="Error_ObjectNotExist",e[e.Error_CommFailure=8]="Error_CommFailure",e[e.Error_UnknownFunctionIdx=9]="Error_UnknownFunctionIdx",e[e.Error_UnknownMessageId=10]="Error_UnknownMessageId",e[e.Error_BadAccess=11]="Error_BadAccess",e[e.Error_BadInput=12]="Error_BadInput"}(t=e.MessageId||(e.MessageId={})),function(e){e[e.Request=0]="Request",e[e.Answer=1]="Answer"}(r=e.MessageType||(e.MessageType={})),function(e){e.Header_Direct=class extends s{get size(){return this.buffer.dv.getUint32(this.offset+0,!0)}set size(e){this.buffer.dv.setUint32(this.offset+0,e,!0)}get msg_id(){return this.buffer.dv.getUint32(this.offset+4,!0)}set msg_id(e){this.buffer.dv.setUint32(this.offset+4,e,!0)}get msg_type(){return this.buffer.dv.getUint32(this.offset+8,!0)}set msg_type(e){this.buffer.dv.setUint32(this.offset+8,e,!0)}get request_id(){return this.buffer.dv.getUint32(this.offset+12,!0)}set request_id(e){this.buffer.dv.setUint32(this.offset+12,e,!0)}}}(i=e.Flat_nprpc_base||(e.Flat_nprpc_base={})),function(e){e.CallHeader_Direct=class extends s{get poa_idx(){return this.buffer.dv.getUint16(this.offset+0,!0)}set poa_idx(e){this.buffer.dv.setUint16(this.offset+0,e,!0)}get interface_idx(){return this.buffer.dv.getUint8(this.offset+2)}set interface_idx(e){this.buffer.dv.setUint8(this.offset+2,e)}get function_idx(){return this.buffer.dv.getUint8(this.offset+3)}set function_idx(e){this.buffer.dv.setUint8(this.offset+3,e)}get object_id(){return this.buffer.dv.getBigUint64(this.offset+8,!0)}set object_id(e){this.buffer.dv.setBigUint64(this.offset+8,e,!0)}}}(i=e.Flat_nprpc_base||(e.Flat_nprpc_base={}))}(Ue||(Ue={})),function(e){var t;(t=e.helpers||(e.helpers={})).assign_from_flat_ObjectId=e=>{let t={};return t={},t.object_id=e.object_id,t.poa_idx=e.poa_idx,t.flags=e.flags,t.origin=e.origin_d().typed_array,t.class_id=e.class_id,t.urls=e.urls,t},t.assign_from_ts_ObjectId=(e,t)=>{e.object_id=t.object_id,e.poa_idx=t.poa_idx,e.flags=t.flags,e.origin_d().copy_from_typed_array(t.origin),e.class_id=t.class_id,e.urls=t.urls}}(xe||(xe={}));const Fe=16,Me=0xffffffffffffffffn;let Be,ke={secured:!1,objects:{}},Se=ve.DebugLevel_Critical;class Te{constructor(e,t,s){this.type=e,this.hostname=t,this.port=s}static to_string(e){switch(e){case we.WebSocket:return"ws://";case we.SecuredWebSocket:return"wss://";default:throw new ce("Unknown EndPointType")}}static from_string(e){let t;if(e.startsWith("ws://"))t=we.WebSocket;else{if(!e.startsWith("wss://"))throw new ce("Invalid EndPoint string: "+e);t=we.SecuredWebSocket}let s=e.indexOf("://")+3,r=e.indexOf(":",s);if(r<0)throw new ce("Invalid EndPoint string: "+e);let i=e.substring(s,r),n=e.substring(r+1),f=parseInt(n,10);if(isNaN(f)||f<0||f>65535)throw new ce("Invalid port in EndPoint string: "+e);return new Te(t,i,f)}equal(e){return this.type===e.type&&this.hostname===e.hostname&&this.port===e.port}to_string(){return`${Te.to_string(this.type)}${this.hostname}:${this.port}`}}function Ve(e,t,s){for(;;){let r=Be.get_poa(t);if(!r){$e(e,Ue.MessageId.Error_PoaNotExist),console.log("Bad poa index. "+t);break}let i=r.get_object(s);if(!i){$e(e,Ue.MessageId.Error_ObjectNotExist),console.log("Object not found. "+s);break}return i}return null}class qe{async perform_request(e,t){t.write_request_id(e),this.ws.send(t.writable_view)}on_open(){}async send_receive(e,t){const s=this.next_request_id++,r=new be;if(this.pending_requests.set(s,{buffer:e,promise:r}),this.ws.readyState===WebSocket.OPEN)this.perform_request(s,e);else{const t=this.ws.onopen;this.ws.onopen=r=>{t&&t.call(this.ws,r),this.pending_requests.has(s)&&this.perform_request(s,e)}}return r.$}on_read(e){let t=ue.from_array_buffer(e.data);if(t.read_msg_type()==Ue.MessageType.Answer){const s=t.read_request_id(),r=this.pending_requests.get(s);r?(r.buffer.set_buffer(e.data),this.pending_requests.delete(s),r.promise.set_promise()):console.warn("Received response for unknown request ID:",s)}else{const e=t.read_request_id();switch(t.read_msg_id()){case Ue.MessageId.FunctionCall:{let e=new Ue.Flat_nprpc_base.CallHeader_Direct(t,Fe);Se>=ve.DebugLevel_EveryCall&&console.log("FunctionCall. interface_idx: "+e.interface_idx+" , fn_idx: "+e.function_idx+" , poa_idx: "+e.poa_idx+" , oid: "+e.object_id);let s=Ve(t,e.poa_idx,e.object_id);s&&s.dispatch(t,this.endpoint,!1);break}case Ue.MessageId.AddReference:{let e=new xe.Flat_nprpc_base.ObjectIdLocal_Direct(t,Fe);Se>=ve.DebugLevel_EveryCall&&console.log("AddReference. poa_idx: "+e.poa_idx+" , oid: "+e.object_id),Ve(t,e.poa_idx,e.object_id)&&$e(t,Ue.MessageId.Success);break}case Ue.MessageId.ReleaseObject:new xe.Flat_nprpc_base.ObjectIdLocal_Direct(t,Fe);break;default:$e(t,Ue.MessageId.Error_UnknownMessageId)}t.write_request_id(e),this.ws.send(t.writable_view)}}on_close(){for(const[e,t]of this.pending_requests)t.promise.set_exception(new Error("Connection closed"));this.pending_requests.clear()}on_error(e){for(const[e,t]of this.pending_requests)t.promise.set_exception(new Error("Connection error"));this.pending_requests.clear()}constructor(e){if(this.endpoint=e,this.pending_requests=new Map,this.next_request_id=1,ke.secured)this.ws=new WebSocket("wss://"+this.endpoint.hostname+":"+this.endpoint.port.toString(10));else{const e=this.endpoint.hostname;this.ws=new WebSocket("ws://"+e+":"+this.endpoint.port.toString(10))}this.ws.binaryType="arraybuffer",this.ws.onopen=this.on_open.bind(this),this.ws.onclose=this.on_close.bind(this),this.ws.onmessage=this.on_read.bind(this),this.ws.onerror=this.on_error.bind(this)}}class Ce{get_connection(e){let t=this.opened_connections_.find((t=>t.endpoint.equal(e)));if(t)return t;let s=new qe(e);return this.opened_connections_.push(s),s}create_poa(e){let t=new Pe(this.last_poa_id_++,e);return this.poa_list_.push(t),t}get_poa(e){return e>=this.poa_list_.length||e<0?null:this.poa_list_[e]}async call(e,t,s=2500){return this.get_connection(e).send_receive(t,s)}static async read_host(){let e=await fetch("./host.json");if(!e.ok)throw"read_host error: "+e.statusText;let t=JSON.parse(await e.text(),((e,t)=>"object_id"===e?BigInt(t):t));null==t.secured&&(t.secured=!1),ke.secured=t.secured;for(let e of Object.keys(t.objects))try{(t.objects[e]=new We(t.objects[e])).select_endpoint()}catch(s){console.error("Error creating ObjectProxy for key: "+e,s),delete t.objects[e]}return t}constructor(e){this.last_poa_id_=0,this.opened_connections_=new Array,this.poa_list_=new Array,e=this.host_info=e}}const Re=e=>Number(0xffffffffn&e),Le=e=>Number(e>>32n);class Ne{add(e){let t=this.tail_idx_;if(t==this.max_size_)return Me;let s=this.data_[this.tail_idx_];return this.tail_idx_=Re(s.oid),s.obj=e,BigInt(t)|BigInt(Le(s.oid))<<32n}remove(e){let t=Re(e);this.data_[t].oid=BigInt(this.tail_idx_)|BigInt(Le(e)+1),this.data_[t].obj=null,this.tail_idx_=t}get(e){let t=Re(e);if(t>=this.max_size_)return null;let s=this.data_[t];return Le(s.oid)!=Le(e)?null:s.obj}constructor(e){this.max_size_=e,this.data_=new Array(this.max_size_);for(let e=0;e<this.max_size_;++e)this.data_[e]={oid:BigInt(e+1),obj:null};Object.seal(this.data_),this.tail_idx_=0}}class Pe{get index(){return this.index_}get_object(e){return this.object_map_.get(e)}activate_object(e){e.poa_=this,e.activation_time_=Date.now();let t=this.object_map_.add(e);if(t===Me)throw new ce("Poa fixed size has been exceeded");return e.object_id_=t,e.ref_cnt_=0,{object_id:t,poa_idx:this.index,flags:xe.ObjectFlag.Tethered,origin:new Uint8Array(16).fill(0),class_id:e.get_class(),urls:""}}deactivate_object(e){}constructor(e,t){this.index_=e,this.object_map_=new Ne(t)}}class We{constructor(e){this.data=e||{},this.timeout_ms_=1e3,this.local_ref_cnt_=0}get endpoint(){return void 0!==this.endpoint_||this.select_endpoint(),this.endpoint_}get timeout(){return this.timeout_ms_}add_ref(){if(this.local_ref_cnt_++,1!=this.local_ref_cnt_)return this.local_ref_cnt_;let e=ue.create(32);e.write_len(28),e.write_msg_id(Ue.MessageId.AddReference),e.write_msg_type(Ue.MessageType.Request);let t=new xe.Flat_nprpc_base.ObjectIdLocal_Direct(e,Fe);return t.poa_idx=this.data.poa_idx,t.object_id=this.data.object_id,e.commit(32),Be.call(this.endpoint,e,this.timeout).then().catch(),this.local_ref_cnt_}release(){if(0!=--this.local_ref_cnt_)return this.local_ref_cnt_;let e=ue.create(32);e.write_len(28),e.write_msg_id(Ue.MessageId.ReleaseObject),e.write_msg_type(Ue.MessageType.Request);let t=new xe.Flat_nprpc_base.ObjectIdLocal_Direct(e,Fe);return t.poa_idx=this.data.poa_idx,t.object_id=this.data.object_id,e.commit(32),Be.call(this.endpoint,e,this.timeout).then().catch(),0}select_endpoint(e){const t=this.data.urls.split(";");if(ke.secured){const e=t.find((e=>e.startsWith("wss://")));if(!e)throw new ce("Object has no urls for secured connection");this.endpoint_=Te.from_string(e)}else{const e=t.find((e=>e.startsWith("ws://")));if(!e)throw new ce("Object has no urls for unsecured connection");this.endpoint_=Te.from_string(e)}e&&("localhost"!==this.endpoint_.hostname&&"127.0.0.1"!==this.endpoint_.hostname||(this.endpoint_.hostname=e.hostname))}}class He{get poa(){return this.poa_}get oid(){return this.object_id_}add_ref(){return++this.ref_cnt_}constructor(){this.ref_cnt_=0}}const $e=(e,t)=>{e.consume(e.size),e.prepare(Fe),e.write_len(12),e.write_msg_id(t),e.write_msg_type(Ue.MessageType.Answer),e.commit(Fe)};class Je{add_ref(e){this.refs.push({object_id:{poa_idx:e.poa.index,object_id:e.oid},obj:e}),e.add_ref()}remove_ref(e,t){return!1}constructor(){this.refs=new Array}}const Ge=e=>{switch(e.read_msg_id()){case Ue.MessageId.Success:return 0;case Ue.MessageId.Exception:return 1;case Ue.MessageId.Error_ObjectNotExist:throw new Ie;case Ue.MessageId.Error_CommFailure:let t=new me.ExceptionCommFailure_Direct(e,16);throw new ye(t.what);case Ue.MessageId.Error_UnknownFunctionIdx:throw new je;case Ue.MessageId.Error_UnknownMessageId:throw new Ae;case Ue.MessageId.Error_BadAccess:throw new ze;default:return-1}},Ke=xe.helpers.assign_from_flat_ObjectId,Qe=xe.helpers.assign_from_ts_ObjectId,Xe=(e,t)=>{if(e.data.class_id!==t.servant_t._get_class())return console.warn("fail: narrowing from "+e.data.class_id+" to "+t.servant_t._get_class()),null;let s=new t;return s.data=e.data,s.local_ref_cnt_=e.local_ref_cnt_,s.timeout_ms_=e.timeout_ms_,e.data=null,e.local_ref_cnt_=0,s},Ye=(e,t)=>{if(e.object_id==Me)return null;const s=new We(xe.helpers.assign_from_flat_ObjectId(e));return e.flags&xe.ObjectFlag.Tethered?(s.data.urls=t.to_string(),s.endpoint_=t):s.select_endpoint(t),s},Ze=async(e=!0)=>Be||(Be=new Ce(e?await Ce.read_host():{})),et=e=>{Se=e},tt=new TextEncoder,st=new TextDecoder;class rt extends We{static get servant_t(){return it}async Bind(e,t){let s=2==arguments.length?0:arguments[arguments.length-1],r=ue.create();r.prepare(216),r.commit(88),r.write_msg_id(Ue.MessageId.FunctionCall),r.write_msg_type(Ue.MessageType.Request);let i=new Ue.Flat_nprpc_base.CallHeader_Direct(r,16);i.object_id=this.data.object_id,i.poa_idx=this.data.poa_idx,i.interface_idx=s,i.function_idx=0;let n=new nt.nprpc_nameserver_M1_Direct(r,32);Qe(n._1,e),n._2=t,r.write_len(r.size-4),await Be.call(this.endpoint,r,this.timeout),0!=Ge(r)&&console.log("received an unusual reply for function with no output arguments")}async Resolve(e,t){let s=2==arguments.length?0:arguments[arguments.length-1],r=ue.create();r.prepare(168),r.commit(40),r.write_msg_id(Ue.MessageId.FunctionCall),r.write_msg_type(Ue.MessageType.Request);let i=new Ue.Flat_nprpc_base.CallHeader_Direct(r,16);if(i.object_id=this.data.object_id,i.poa_idx=this.data.poa_idx,i.interface_idx=s,i.function_idx=1,new nt.nprpc_nameserver_M2_Direct(r,32)._1=e,r.write_len(r.size-4),await Be.call(this.endpoint,r,this.timeout),-1!=Ge(r))throw console.log("received an unusual reply for function with output arguments"),new ce("Unknown Error");let n,f=new nt.nprpc_nameserver_M3_Direct(r,16);return t.value=Ye(f._2,this.endpoint),n=f._1,n}}class it extends He{constructor(){super(...arguments),this.get_class=()=>it._get_class(),this.dispatch=(e,t,s)=>{it._dispatch(this,e,t,s)}}static _get_class(){return"nprpc_nameserver/nprpc.Nameserver"}static _dispatch(e,t,s,r){switch(new Ue.Flat_nprpc_base.CallHeader_Direct(t,16).function_idx){case 0:{let r=new nt.nprpc_nameserver_M1_Direct(t,32);e.Bind(Ye(r._1,s),r._2),$e(t,Ue.MessageId.Success);break}case 1:{let s=new nt.nprpc_nameserver_M2_Direct(t,32),r=t;r.consume(r.size),r.prepare(200),r.commit(72);let i,n=new nt.nprpc_nameserver_M3_Direct(r,16);i=e.Resolve(s._1,n._2),n._1=i,r.write_len(r.size-4),r.write_msg_id(Ue.MessageId.BlockResponse),r.write_msg_type(Ue.MessageType.Answer);break}default:$e(t,Ue.MessageId.Error_UnknownFunctionIdx)}}}var nt;function ft(e){const t={object_id:0n,poa_idx:0,flags:xe.ObjectFlag.Persistent,origin:new Uint8Array(16).fill(0),class_id:it._get_class(),urls:"ws://"+e+":15001"},s=new rt(t);return s.select_endpoint(),s}!function(e){e.nprpc_nameserver_M1_Direct=class extends s{get _1(){return new xe.Flat_nprpc_base.ObjectId_Direct(this.buffer,this.offset+0)}get _2(){const e=this.offset+48,t=this.buffer.dv.getUint32(e+4,!0);return t>0?st.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set _2(e){const t=tt.encode(e),s=r(this.buffer,this.offset+48,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}}(nt||(nt={})),function(e){e.nprpc_nameserver_M2_Direct=class extends s{get _1(){const e=this.offset+0,t=this.buffer.dv.getUint32(e+4,!0);return t>0?st.decode(new DataView(this.buffer.array_buffer,e+this.buffer.dv.getUint32(e,!0),t)):""}set _1(e){const t=tt.encode(e),s=r(this.buffer,this.offset+0,t.length,1,1);new Uint8Array(this.buffer.array_buffer,s).set(t)}}}(nt||(nt={})),function(e){e.nprpc_nameserver_M3_Direct=class extends s{get _1(){return 1===this.buffer.dv.getUint8(this.offset+0)}set _1(e){this.buffer.dv.setUint8(this.offset+0,!0===e?1:0)}get _2(){return new xe.Flat_nprpc_base.ObjectId_Direct(this.buffer,this.offset+8)}}}(nt||(nt={}));export{qe as Connection,ve as DebugLevel,Te as EndPoint,we as EndPointType,ce as Exception,ze as ExceptionBadAccess,Oe as ExceptionBadInput,ye as ExceptionCommFailure,Ie as ExceptionObjectNotExist,De as ExceptionTimeout,je as ExceptionUnknownFunctionIndex,Ae as ExceptionUnknownMessageId,Ee as ExceptionUnsecuredObject,t as Flat,ue as FlatBuffer,me as Flat_nprpc_base,nt as Flat_nprpc_nameserver,be as MyPromise,rt as Nameserver,We as ObjectProxy,He as ObjectServant,Pe as Poa,Je as ReferenceList,Ce as Rpc,it as _INameserver_Servant,Ye as create_object_from_flat,xe as detail,ft as get_nameserver,Ge as handle_standart_reply,Ue as impl,Ze as init,de as ip4tostr,le as make_ref,$e as make_simple_answer,Xe as narrow,Qe as oid_assign_from_ts,Ke as oid_create_from_flat,Be as rpc,et as set_debug_level,he as sip4_to_u32};